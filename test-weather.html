<!DOCTYPE html>
<html>
<head>
    <title>Weather API Test</title>
</head>
<body>
    <h1>NOAA Weather API Test</h1>
    <div id="status">Loading...</div>
    <div id="weather-container">
        <img id="weather-image" style="width: 800px; height: 400px; border: 1px solid #ccc;" />
    </div>

    <script>
        // Test the same static weather overlay URL
        const conus_bbox = "-130,20,-60,50"; // Entire Continental US
        const image_width = 1024;
        const image_height = 512;
        const cacheTimestamp = Math.floor(Date.now() / (10 * 60 * 1000)) * (10 * 60 * 1000);
        
        // Try different weather services to find one that works
        const testUrls = [
            // NWS Ridge Radar
            `https://mapservices.weather.noaa.gov/eventdriven/rest/services/radar/radar_base_reflectivity_time/MapServer/export?bbox=${conus_bbox}&bboxSR=4326&imageSR=4326&size=${image_width},${image_height}&format=png&transparent=true&f=image`,
            
            // Iowa Environmental Mesonet (reliable alternative)
            `https://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&LAYERS=nexrad-n0r-900913&BBOX=${conus_bbox.split(',').join(',')}&WIDTH=${image_width}&HEIGHT=${image_height}&SRS=EPSG:4326&FORMAT=image/png&TRANSPARENT=true`,
            
            // Alternative NOAA service
            `https://idpgis.ncep.noaa.gov/arcgis/services/NWS_Observations/radar_base_reflectivity/MapServer/WMSServer?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&BBOX=${conus_bbox}&CRS=EPSG:4326&WIDTH=${image_width}&HEIGHT=${image_height}&LAYERS=0&FORMAT=image/png&TRANSPARENT=true`
        ];
        
        let currentIndex = 0;
        const weatherUrl = testUrls[currentIndex];
        
        console.log('Testing weather URL:', weatherUrl);
        document.getElementById('status').textContent = `Testing: ${weatherUrl}`;
        
        const img = document.getElementById('weather-image');
        
        function tryNextUrl() {
            if (currentIndex < testUrls.length) {
                const url = testUrls[currentIndex];
                console.log(`Testing URL ${currentIndex + 1}/${testUrls.length}:`, url);
                document.getElementById('status').textContent = `Testing URL ${currentIndex + 1}/${testUrls.length}...`;
                img.src = url;
            } else {
                console.error('❌ All weather services failed');
                document.getElementById('status').textContent = '❌ All weather services failed';
                document.getElementById('status').style.color = 'red';
            }
        }

        img.onload = function() {
            console.log(`✅ Weather service ${currentIndex + 1} loaded successfully!`);
            document.getElementById('status').textContent = `✅ Weather service ${currentIndex + 1} loaded successfully!`;
            document.getElementById('status').style.color = 'green';
        };
        
        img.onerror = function(e) {
            console.error(`❌ Weather service ${currentIndex + 1} failed:`, e);
            currentIndex++;
            setTimeout(tryNextUrl, 1000); // Try next URL after 1 second
        };
        
        // Start testing
        tryNextUrl();
    </script>
</body>
</html>